#STEP 1(Creating namespaces and links)
#-------------------------------------
sudo ip link add h1-eth0 type veth peer name eth1
sleep 1
sudo ip netns add h1
sudo ip link set h1-eth0 netns h1
sudo ip netns exec h1 ifconfig h1-eth0 10.10.2.2/24
#sudo stop network-manager
sudo ifconfig eth1 10.10.2.1/24
#(Anothern portal interface would be real interface. 10.1.0.13  : Set the PortalsVega.java like that)
sudo ip netns exec h1 ifconfig lo up
sudo ip netns exec h1 ping -c1 10.10.2.1
sudo ping -c1 10.10.2.2

#STEP2 (SETTING ROUTES):
#----------------------
#sudo ip netns exec h1 ifconfig h1-eth0 down
#sudo ip netns exec h1 ifconfig h1-eth0 up
sudo ip netns exec h1 ip route add 192.168.0.0/16 via 10.10.2.1
sudo ip netns exec h1 ip route add 192.170.0.0/16 via 10.10.2.1
sudo ip netns exec h1 ip route add 10.10.2.0/24 via 10.10.2.1

#sudo ifconfig eth2 down
#sudo ifconfig eth2 up


#Step2: Compile Model
#---------------------
java -DRUNTIME_ENV=[c_slave1,d_slave1,eth2,10.10.2.1,eth3,10.1.0.28] -DPORTAL_LINKS=c_slave1:eth2,topnet.portal_router.portal_if_10_10_2_0,c_slave1:eth3,topnet.center_router.portal_if_10_1_0_0 -jar ../primogeni/netscript/dist/jprime.jar create MininetConfluxPolluxEmulated MininetConfluxPolluxEmulated.java 192.170.0.0/16



#STEP 3; Creating Emulated host and the veth(assign Ip and HW addr - get these from the model xml file)
#------------------------------------------------------------------
sudo ip link add h2-eth0 type veth peer name veth52
#52 is the uid of the interface taken from the xml file
sleep 1
sudo ip netns add h2
sudo ip link set h2-eth0 netns h2
sudo ip netns exec h2 ifconfig h2-eth0 down
sudo ip netns exec h2 ifconfig h2-eth0  hw ether 00:00:00:00:00:34
sudo ip netns exec h2 ifconfig h2-eth0 192.168.0.9/24
sudo ip netns exec h2 ifconfig lo up
sudo ip netns exec h2 ifconfig h2-eth0 up
sudo ip netns exec h2 ping -c1 192.168.0.9
#U find out h3 in the xml part file and check what is the uid of its if interface. say uid =52
#then 34 is hex of veth52 
sudo ifconfig veth52 up



#Run Model
#---------
../primogeni/netsim/primex -tp 10.1.0.28 82 -tp 10.10.2.1 110 600 MininetConfluxPolluxEmulated_part_1.tlv


#Test:
#----
sudo ip netns exec h1 ping 10.10.1.1
sudo ip netns exec h1 ping 192.170.0.1
sudo ip netns exec h2 ping 192.168.0.5


#On castor (add route) -clean route before
ip route del 10.10.2.0/24
ip route add 10.10.2.0/24 via 10.1.0.28

#Ping across the network
sudo ip netns exec h1 ping 10.10.2.2

#Does castor need ip_forward? NO?
##Packets take too long and packets are droping

#root@castor:~# sudo ip netns exec h1 ping 10.10.2.2
#PING 10.10.2.2 (10.10.2.2) 56(84) bytes of data.
#64 bytes from 10.10.2.2: icmp_req=2 ttl=47 time=27.0 ms
#64 bytes from 10.10.2.2: icmp_req=6 ttl=47 time=727 ms
#64 bytes from 10.10.2.2: icmp_req=17 ttl=47 time=648 ms
#64 bytes from 10.10.2.2: icmp_req=18 ttl=47 time=648 ms
#64 bytes from 10.10.2.2: icmp_req=21 ttl=47 time=85.4 ms
#^C
#--- 10.10.2.2 ping statistics ---
#21 packets transmitted, 5 received, 76% packet loss, time 20121ms
#rtt min/avg/max/mdev = 27.087/427.394/727.268/304.931 ms


