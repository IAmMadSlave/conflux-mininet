 h1 (h1-eth0) 10.10.1.2
 h2 (h2-eth0) 10.10.1.1 (192.168.0.0) (h2-eth1) 10.10.3.2
 h3 (h3-eth0) 10.10.3.1 

STEP 1 (compiling models):
------------------------
java -DRUNTIME_ENV=[c_slave1,d_slave1,eth2,10.10.1.1,eth3,10.10.3.2] -DPORTAL_LINKS=c_slave1:eth2,topnet.net01.net1.r1.portal_10_1_2_0,c_slave1:eth3,topnet.net2.r5.portal_10_1_3_0 -jar ../primogeni/netscript/dist/jprime.jar create Portals5 Portals5.java 192.168.0.0/16

STEP 2 (Creating 2 veth pairs - a total of 4 interfaces) 
sudo ip link add h1-eth0 type veth peer name h2-eth0
sudo ip link add h2-eth1 type veth peer name h3-eth0

(Create 3 namespaces)
sudo ip netns add h1
sudo ip netns add h2
sudo ip netns add h3

(Add the 4 interfaces to their respective namespaced hosts)
sudo ip link set h1-eth0 netns h1
sudo ip link set h2-eth0 netns h2
sudo ip link set h2-eth1 netns h2
sudo ip link set h3-eth0 netns h3

(Configure all IP addresses of the 4 interfaces)
sudo ip netns exec h1 ifconfig h1-eth0 10.10.1.2/24
sudo ip netns exec h2 ifconfig h2-eth0 10.10.1.1/24
sudo ip netns exec h2 ifconfig h2-eth1 10.10.3.2/24
sudo ip netns exec h3 ifconfig h3-eth0 10.10.3.1/24

(Loop back interfaces)
sudo ip netns exec h1 ifconfig lo up
sudo ip netns exec h2 ifconfig lo up
sudo ip netns exec h3 ifconfig lo up

(Check connectivity)
sudo ip netns exec h1 ping -c1 10.10.1.1
sudo ip netns exec h2 ping -c1 10.10.1.2
sudo ip netns exec h2 ping -c1 10.10.3.1
sudo ip netns exec h3 ping -c1 10.10.3.2

STEP3 (SETTING ROUTES - add them line by line):
----------------------
sudo ip netns exec h1 ifconfig h1-eth0 down
sudo ip netns exec h1 ifconfig h1-eth0 up
sudo ip netns exec h1 ip route add 10.10.3.0/24 via 10.10.1.1

sudo ip netns exec h2 ifconfig h2-eth0 down
sudo ip netns exec h2 ifconfig h2-eth0 up
sudo ip netns exec h2 ifconfig h2-eth1 down
sudo ip netns exec h2 ifconfig h2-eth1 up

sudo ip netns exec h3 ifconfig h3-eth0 down
sudo ip netns exec h3 ifconfig h3-eth0 up
sudo ip netns exec h3 ip route add 10.10.1.0/24 via 10.10.3.2

sudo ip netns exec h2 ~/primogeni/netsim/primex -tp 10.10.3.2 166 -tp 10.10.1.1 605 600 Portals5_part_1.tlv

###############################################################################
					ROUTING TABLE AND INTERFACES
###############################################################################
(CHECKING - SKIPPING FOR NOW) 
cesar@primex ~/experiments2> sudo ip netns exec h1 route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.10.1.0       *               255.255.255.0   U     0      0        0 h1-eth0
10.10.5.0       10.10.1.1       255.255.255.0   UG    0      0        0 h1-eth0
192.168.0.0     10.10.1.1       255.255.0.0     UG    0      0        0 h1-eth0
192.170.0.0     10.10.1.1       255.255.0.0     UG    0      0        0 h1-eth0

cesar@primex ~/experiments2> sudo ip netns exec h2 route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.10.1.0       *               255.255.255.0   U     0      0        0 h2-eth0
10.10.3.0       *               255.255.255.0   U     0      0        0 h2-eth1
192.170.0.0     10.10.3.1       255.255.0.0     UG    0      0        0 h2-eth1

cesar@primex ~/experiments2> sudo ip netns exec h3 route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.10.1.0       10.10.3.2       255.255.255.0   UG    0      0        0 h3-eth0
10.10.3.0       *               255.255.255.0   U     0      0        0 h3-eth0
10.10.5.0       *               255.255.255.0   U     0      0        0 h3-eth1
192.168.0.0     10.10.3.2       255.255.0.0     UG    0      0        0 h3-eth0

cesar@primex ~/experiments2> sudo ip netns exec h4 route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.10.1.0       10.10.5.1       255.255.255.0   UG    0      0        0 h4-eth0
10.10.5.0       *               255.255.255.0   U     0      0        0 h4-eth0
192.168.0.0     10.10.5.1       255.255.0.0     UG    0      0        0 h4-eth0
192.170.0.0     10.10.5.1       255.255.0.0     UG    0      0        0 h4-eth0

###############################################################################
cesar@primex ~/experiments2> sudo ip netns exec h1 ifconfig
h1-eth0   Link encap:Ethernet  HWaddr c2:53:0e:f1:44:74
          inet addr:10.10.1.2  Bcast:10.10.1.255  Mask:255.255.255.0

cesar@primex ~/experiments2> sudo ip netns exec h2 ifconfig
h2-eth0   Link encap:Ethernet  HWaddr 0e:66:49:76:98:fd
          inet addr:10.10.1.1  Bcast:10.10.1.255  Mask:255.255.255.0

h2-eth1   Link encap:Ethernet  HWaddr ba:a1:b8:5b:0f:75
          inet addr:10.10.3.2  Bcast:10.10.3.255  Mask:255.255.255.0

cesar@primex ~/experiments2> sudo ip netns exec h3 ifconfig
h3-eth0   Link encap:Ethernet  HWaddr be:9f:13:d6:0c:8f
          inet addr:10.10.3.1  Bcast:10.10.3.255  Mask:255.255.255.0

h3-eth1   Link encap:Ethernet  HWaddr 8e:26:6b:fa:d9:ad
          inet addr:10.10.5.1  Bcast:10.10.5.255  Mask:255.255.255.0

cesar@primex ~/experiments2> sudo ip netns exec h4 ifconfig
h4-eth0   Link encap:Ethernet  HWaddr 7e:4e:3f:3b:df:2f
          inet addr:10.10.5.2  Bcast:10.10.5.255  Mask:255.255.255.0

###############################################################################


#################################################################################
					SOME PING AND WGET RESULTS
##################################################################################
cesar@primex ~/experiments2> sudo ip netns exec h1 ping -c1 192.168.1.50
PING 192.168.1.50 (192.168.1.50) 56(84) bytes of data.
64 bytes from 192.168.1.50: icmp_req=1 ttl=60 time=1.65 ms

--- 192.168.1.50 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 1.657/1.657/1.657/0.000 ms


###############################################################################
IF Portal4.java has: (DOES NOT WORK)

        right_portal.createTrafficPortal();
        right_portal.setIpAddress("10.10.3.1");
        right_portal.addReachableNetwork("192.168.0.0/16");
        right_portal.addReachableNetwork("10.10.1.0/24");

cesar@primex ~/experiments2> sudo ip netns exec h1 ping -c1 192.170.1.50
PING 192.170.1.50 (192.170.1.50) 56(84) bytes of data.
^C
--- 192.170.1.50 ping statistics ---
1 packets transmitted, 0 received, 100% packet loss, time 0ms

###############################################################################
IF Portal4.java has: (WORK)

        right_portal.createTrafficPortal();
        right_portal.setIpAddress("10.10.3.1");
        right_portal.addReachableNetwork("10.10.1.0/24");
        right_portal.addReachableNetwork("192.168.0.0/16");

cesar@primex ~/experiments2> sudo ip netns exec h1 ping -c1 192.170.1.50
PING 192.170.1.50 (192.170.1.50) 56(84) bytes of data.
64 bytes from 192.170.1.50: icmp_req=1 ttl=46 time=5.74 ms

--- 192.170.1.50 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 5.745/5.745/5.745/0.000 ms

CONCLUSION - just work with a SINGLE Reachable Network - need to fix that

###############################################################################
THEN, Portal3 has to be reachable 10.10.1.0/24 and 10.10.5.0/24

        left_portal.createTrafficPortal();
        left_portal.setIpAddress("10.10.1.1");
        left_portal.addReachableNetwork("10.10.1.0/24");

        right_portal.createTrafficPortal();
        right_portal.setIpAddress("10.10.3.2");
        right_portal.addReachableNetwork("10.10.5.0/24");

ALSO, Portal4 has to be reachable 10.10.1.0/24 and 10.10.5.0/24

        left_portal.createTrafficPortal();
        left_portal.setIpAddress("10.10.5.1");
        left_portal.addReachableNetwork("10.10.5.0/24");

        right_portal.createTrafficPortal();
        right_portal.setIpAddress("10.10.3.1");
        right_portal.addReachableNetwork("10.10.1.0/24");

###############################################################################
remove all static routes to simulated networks
add only routes to the networks that matter 10.10.1.0 and 10.10.5.0


