#Geni topology:

#portal(10.10.2.2)-------geni1(10.10.1.1/24)<========physical=======> geni2(10.10.1.2/24)-------portal(10.10.3.1)
#                           192.168/16		                           192.170/16
#
######################################On geni1(CTID has to be a number)#################################
/usr/sbin/vzctl create 101 --ostemplate centos-6-x86_64-minimal --config basic
/usr/sbin/vzctl set 101 --onboot yes --save
/usr/sbin/vzctl set 101 --hostname host_101 --save
/usr/sbin/vzctl set 101 --nameserver 10.1.0.1 --save
/usr/sbin/vzctl start 101

#Setting Network and forwarding:
perl /primex/scripts/confVENetwork.pl 101 eth2 10.10.2.2/24 00:00:00:00:00:d8 66:00:00:00:00:d8
ifconfig eth2 10.10.2.1/24
vzctl enter 101
ip route add 192.168.0.0/16 via 10.10.2.1
ip route add 192.170.0.0/16 via 10.10.2.1
ip route add 10.10.3.0/24 via 10.10.2.1
exit

#Compiling model(no ip since there is a problem with assigning Ip to the simulated model):
java -DRUNTIME_ENV=[c_slave1,d_slave1,eth2,10.10.2.1,eth3,10.10.1.1] -DPORTAL_LINKS=c_slave1:eth2,topnet.portal_router.portal_if_10_10_2_0,c_slave1:eth3,topnet.center_router.portal_if_10_10_1_0 -jar /primex/primogeni/netscript/dist/jprime.jar create MininetConfluxCastorEmulated MininetConfluxCastorEmulated.java

#Running (Get portal_rules from the model file):
/primex/primogeni/netsim/primex -tp 10.10.1.1 81 -tp 10.10.2.1 109 3600 MininetConfluxCastorEmulated_part_1.tlv
/primex/primogeni/netsim/primex -tp 10.10.1.1 81 -tp 10.10.2.1 109 3600 MininetConfluxCastorEmulatedBW150_part_1.tlv
/primex/primogeni/netsim/primex -tp 10.10.1.1 81 -tp 10.10.2.1 109 3600 MininetConfluxCastorEmulatedBW1000_part_1.tlv

#After run fix route
ifconfig eth1 down
ifconfig eth1 up
ip route del 10.10.3.0/24
ip route add 10.10.3.0/24 via 10.10.1.2
#Weird no route for 10.10.2.0
ifconfig eth2 down
ifconfig eth2 up
ping -c1 10.10.1.1
ping -c1 10.10.1.2
ping -c1 10.10.2.1
ping -c1 10.10.2.2

#Test:
vzctl enter 101
iperf -c 10.10.3.2




######################################On geni2#################################
/usr/sbin/vzctl create 102 --ostemplate centos-6-x86_64-minimal --config basic
/usr/sbin/vzctl set 102 --onboot yes --save
/usr/sbin/vzctl set 102 --hostname host_102 --save
/usr/sbin/vzctl set 102 --nameserver 10.1.0.1 --save
/usr/sbin/vzctl start 102
#Setting Network and forwarding
perl /primex/scripts/confVENetwork.pl 102 eth2 10.10.3.2/24 00:00:00:00:00:22 66:00:00:00:00:22
ifconfig eth2 10.10.3.1/24
vzctl enter 102
ip route add 192.168.0.0/16 via 10.10.3.1
ip route add 192.170.0.0/16 via 10.10.3.1
ip route add 10.10.2.0/24 via 10.10.3.1
exit

#Compiling model(no ip since there is a problem with assigning Ip to the simulated model):
java -DRUNTIME_ENV=[c_slave1,d_slave1,eth2,10.10.3.1,eth3,10.10.1.2] -DPORTAL_LINKS=c_slave1:eth2,topnet.portal_router.portal_if_10_10_3_0,c_slave1:eth3,topnet.center_router.portal_if_10_10_1_0 -jar /primex/primogeni/netscript/dist/jprime.jar create MininetConfluxPolluxEmulated MininetConfluxPolluxEmulated.java



#Running (Get portal_rules from the model file):
/primex/primogeni/netsim/primex -tp 10.10.1.2 81 -tp 10.10.3.1 109 3600 MininetConfluxPolluxEmulated_part_1.tlv
/primex/primogeni/netsim/primex -tp 10.10.1.2 81 -tp 10.10.3.1 109 3600 MininetConfluxPolluxEmulatedBW150_part_1.tlv
/primex/primogeni/netsim/primex -tp 10.10.1.2 81 -tp 10.10.3.1 109 3600 MininetConfluxPolluxEmulatedBW1000_part_1.tlv

#After run fix route
ifconfig eth1 down
ifconfig eth1 up
ip route del 10.10.2.0/24
ip route add 10.10.2.0/24 via 10.10.1.1
#Weird no route for 10.10.2.0
ifconfig eth2 down
ifconfig eth2 up
ping -c1 10.10.1.1
ping -c1 10.10.1.2
ping -c1 10.10.3.1
ping -c1 10.10.3.2

#Test:
vzctl enter 102
iperf -s -i 1




#Adding two lines:
                lrtor.setDelay((float)0.0001);           
                lrtor.setDelay((float)1000000000.00);
