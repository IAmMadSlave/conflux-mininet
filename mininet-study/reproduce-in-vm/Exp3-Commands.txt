(Routing)
h1 ---- h2 ---- h3

sudo ip link add h1-eth0 type veth peer name h2-eth0
sudo ip link add h2-eth1 type veth peer name h3-eth0

sudo ip netns add h1
sudo ip netns add h2
sudo ip netns add h3

sudo ip link set h1-eth0 netns h1
sudo ip link set h2-eth0 netns h2
sudo ip link set h2-eth1 netns h2
sudo ip link set h3-eth0 netns h3

sudo ip netns exec h1 ifconfig h1-eth0 10.10.1.2/24
sudo ip netns exec h2 ifconfig h2-eth0 10.10.1.1/24
sudo ip netns exec h2 ifconfig h2-eth1 10.10.3.2/24
sudo ip netns exec h3 ifconfig h3-eth0 10.10.3.1/24

sudo ip netns exec h1 ifconfig lo up
sudo ip netns exec h2 ifconfig lo up
sudo ip netns exec h3 ifconfig lo up

sudo ip netns exec h1 ping -c1 10.10.1.1
sudo ip netns exec h2 ping -c1 10.10.1.2
sudo ip netns exec h2 ping -c1 10.10.3.1
sudo ip netns exec h3 ping -c1 10.10.3.2

sudo ip netns exec h1 ping -c1 10.10.3.1 (connect: Network is unreachable)
sudo ip netns exec h3 ping -c1 10.10.1.2 (connect: Network is unreachable)

sudo ip netns exec h1 ip route add 10.10.3.0/24 via 10.10.1.1
sudo ip netns exec h2 sysctl -w net.ipv4.ip_forward=1
sudo ip netns exec h3 ip route add 10.10.1.0/24 via 10.10.3.2

sudo brctl addbr portalbr
sudo brctl addif portalbr eth0
sudo brctl addif portalbr pc1-ethP
sudo ifconfig eth0 down
sudo ifconfig pc1-ethP down
sudo ifconfig eth0 0.0.0.0 up
sudo ifconfig pc1-ethP 0.0.0.0 up
sudo ifconfig portalbr 10.1.0.29/16
route add default gw 10.1.0.29

==============================================
sudo ip netns exec h1 ping -c1 10.10.3.1
PING 10.10.3.1 (10.10.3.1) 56(84) bytes of data.
64 bytes from 10.10.3.1: icmp_req=1 ttl=63 time=0.050 ms

--- 10.10.3.1 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.050/0.050/0.050/0.000 ms

==============================================
sudo ip netns exec h3 ping -c1 10.10.1.2
PING 10.10.1.2 (10.10.1.2) 56(84) bytes of data.
64 bytes from 10.10.1.2: icmp_req=1 ttl=63 time=0.046 ms

--- 10.10.1.2 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.046/0.046/0.046/0.000 ms

============================================== (works only in global - not within containers)
sudo sysctl -w net.core.rmem_default=20097152
sudo sysctl -w net.core.wmem_default=20097152
sudo sysctl -w net.core.rmem_max=40485760
sudo sysctl -w net.core.wmem_max=40485760

sudo ip netns exec h3 iperf -s -i 1
sudo ip netns exec h1 iperf -c 10.10.3.1

cesar@primex ~> sudo ip netns exec h3 iperf -s -i 1
[sudo] password for cesar:
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 85.3 KByte (default)
------------------------------------------------------------
[  6] local 10.10.3.1 port 5001 connected with 10.10.1.2 port 39014
[ ID] Interval       Transfer     Bandwidth
[  6]  0.0- 1.0 sec   934 MBytes  7.83 Gbits/sec
[  6]  1.0- 2.0 sec   972 MBytes  8.15 Gbits/sec
[  6]  2.0- 3.0 sec  1024 MBytes  8.59 Gbits/sec
[  6]  3.0- 4.0 sec   990 MBytes  8.30 Gbits/sec
[  6]  4.0- 5.0 sec   982 MBytes  8.24 Gbits/sec
[  6]  5.0- 6.0 sec   945 MBytes  7.93 Gbits/sec
[  6]  6.0- 7.0 sec  1020 MBytes  8.56 Gbits/sec
[  6]  7.0- 8.0 sec  1000 MBytes  8.39 Gbits/sec
[  6]  8.0- 9.0 sec  1023 MBytes  8.58 Gbits/sec
[  6]  9.0-10.0 sec   934 MBytes  7.83 Gbits/sec
[  6]  0.0-10.0 sec  9.59 GBytes  8.23 Gbits/sec


